sudo apt update

ip=`curl ifconfig.me 2>/dev/null` 

sudo apt install docker-compose docker.io wget wireguard-tools -y

echo "Enter admin username [admin]:"
read name

if [ -z "$name" ]; then
  name="admin"
fi

echo "Enter admin password [random]:"
read password

if [ -z "$password" ]; then
  password="$(openssl rand -base64 10)"
fi

export PRIVATE_KEY="$(wg genkey)"

mkdir /data/wg-access-server

cd /data/wg-access-server

if grep -q "^docker:" /etc/group; then
    echo "The 'docker' group exists."
else
    echo "The 'docker' group does not exist."
    # You can add code here to create the group or perform other actions.
fi


if ! getent group docker > /dev/null; then
    sudo groupadd docker
fi

sudo usermod -aG docker $USER
newgrp docker

sudo systemctl enable docker.service
sudo systemctl enable containerd.service

wget https://raw.githubusercontent.com/Pqko0/wg-vpn/main/dk -O docker-compose.yml

sudo sed -i 's/WG_ACCESS_USERNAME_HERE/$(name)/g' docker-compose.yml
sudo sed -i 's/WG_ACCESS_PASSWORD_HERE/$(password)/g' docker-compose.yml
sudo sed -i 's/WG_ACCESS_KEY_HERE/$(PRIVATE_KEY)/g' docker-compose.yml

docker-compose up -d

echo "======== WireGuard Access Server ========"
echo "Thanks for using Pqko0's install script."
echo "Login Information"
echo " -> Admin Username: $name"
echo " -> Admin Password: $password"
echo "WebUI"
echo " -> http://$ip:8000"
echo "========================================"
